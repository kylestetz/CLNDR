/*! clndr.min.js v1.0.13 2013-10-24 */
!function(a,b,c,d){function e(b,c){this.element=b,this.options=a.extend(!0,{},h,c),this.options.events.length&&(this.options.events=this.addMomentObjectToEvents(this.options.events)),this.month=this.options.startWithMonth?moment(this.options.startWithMonth):moment(),this._defaults=h,this._name=g,this.init()}var f="<div class='clndr-controls'><div class='clndr-control-button'><span class='clndr-previous-button'>previous</span></div><div class='month'><%= month %> <%= year %></div><div class='clndr-control-button rightalign'><span class='clndr-next-button'>next</span></div></div><table class='clndr-table' border='0' cellspacing='0' cellpadding='0'><thead><tr class='header-days'><% for(var i = 0; i < daysOfTheWeek.length; i++) { %><td class='header-day'><%= daysOfTheWeek[i] %></td><% } %></tr></thead><tbody><% for(var i = 0; i < numberOfRows; i++){ %><tr><% for(var j = 0; j < 7; j++){ %><% var d = j + i * 7; %><td class='<%= days[d].classes %>'><div class='day-contents'><%= days[d].day %></div></td><% } %></tr><% } %></tbody></table>",g="clndr",h={template:f,weekOffset:0,startWithMonth:null,clickEvents:{click:null,nextMonth:null,previousMonth:null,nextYear:null,previousYear:null,today:null,onMonthChange:null,onYearChange:null},targets:{nextButton:"clndr-next-button",previousButton:"clndr-previous-button",nextYearButton:"clndr-next-year-button",previousYearButton:"clndr-previous-year-button",todayButton:"clndr-today-button",day:"day",empty:"empty"},events:[],extras:null,dateParameter:"date",doneRendering:null,render:null,daysOfTheWeek:null,showAdjacentMonths:!0,adjacentDaysChangeMonth:!1,ready:null};e.prototype.init=function(){if(this.daysOfTheWeek=this.options.daysOfTheWeek||[],!this.options.daysOfTheWeek){this.daysOfTheWeek=[];for(var b=0;7>b;b++)this.daysOfTheWeek.push(moment().weekday(b).format("dd").charAt(0))}if(this.options.weekOffset&&(this.daysOfTheWeek=this.shiftWeekdayLabels(this.options.weekOffset)),!a.isFunction(this.options.render)){if(this.options.render=null,"undefined"==typeof _)throw new Error("Underscore was not found. Please include underscore.js OR provide a custom render function.");this.compiledClndrTemplate=_.template(this.options.template)}a(this.element).html("<div class='clndr'></div>"),this.calendarContainer=a(".clndr",this.element),this.bindEvents(),this.render(),this.options.ready&&this.options.ready.apply(this,[])},e.prototype.shiftWeekdayLabels=function(a){for(var b=this.daysOfTheWeek,c=0;a>c;c++)b.push(b.shift());return b},e.prototype.createDaysObject=function(b){daysArray=[];var c=b.startOf("month");if(this.eventsLastMonth=[],this.eventsThisMonth=[],this.eventsNextMonth=[],this.options.events.length){this.eventsThisMonth=a(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM")==b.format("YYYY-MM")}).toArray();var d=b.clone().subtract("months",1),e=b.clone().add("months",1);this.eventsLastMonth=a(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM")==d.format("YYYY-MM")}).toArray(),this.eventsNextMonth=a(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM")==e.format("YYYY-MM")}).toArray()}var f=c.weekday()-this.options.weekOffset;if(0>f&&(f+=7),this.options.showAdjacentMonths)for(var g=0;f>g;g++){var h=moment([b.year(),b.month(),g-f+1]);daysArray.push(this.createDayObject(h,this.eventsLastMonth))}else for(var g=0;f>g;g++)daysArray.push(this.calendarDay({classes:this.options.targets.empty+" last-month"}));for(var i=c.daysInMonth(),g=1;i>=g;g++){var h=moment([b.year(),b.month(),g]);daysArray.push(this.createDayObject(h,this.eventsThisMonth))}if(this.options.showAdjacentMonths)for(g=1;0!==daysArray.length%7;){var h=moment([b.year(),b.month(),i+g]);daysArray.push(this.createDayObject(h,this.eventsNextMonth)),g++}else for(g=1;0!==daysArray.length%7;)daysArray.push(this.calendarDay({classes:this.options.targets.empty+" next-month"})),g++;return daysArray},e.prototype.createDayObject=function(a,b){var c=[],e=moment(),f=0,g=b.length;for(f;g>f;f++)b[f]._clndrDateObject.date()==a.date()&&c.push(b[f]);var h="";return e.format("YYYY-MM-DD")==a.format("YYYY-MM-DD")&&(h+=" today"),a.isBefore(e,"day")&&(h+=" past"),c.length&&(h+=" event"),this.month.month()>a.month()?(h+=" adjacent-month",h+=this.month.year()===a.year()?" last-month":" next-month"):this.month.month()<a.month()&&(h+=" adjacent-month",h+=this.month.year()===a.year()?" next-month":" last-month"),!a.isValid()&&a.hasOwnProperty("_d")&&a._d!=d&&(a=moment(a._d)),h+=" calendar-day-"+a.format("YYYY-MM-DD"),this.calendarDay({day:a.date(),classes:this.options.targets.day+h,id:"calendar-day-"+a.format("YYYY-MM-DD"),events:c,date:a})},e.prototype.render=function(){this.calendarContainer.children().remove();var a=this.createDaysObject(this.month);this.month;var b={daysOfTheWeek:this.daysOfTheWeek,numberOfRows:Math.ceil(a.length/7),days:a,month:this.month.format("MMMM"),year:this.month.year(),eventsThisMonth:this.eventsThisMonth,eventsLastMonth:this.eventsLastMonth,eventsNextMonth:this.eventsNextMonth,extras:this.options.extras};this.options.render?this.calendarContainer.html(this.options.render.apply(this,[b])):this.calendarContainer.html(this.compiledClndrTemplate(b)),this.options.doneRendering&&this.options.doneRendering.apply(this,[])},e.prototype.bindEvents=function(){var b=a(this.element),c=this;b.on("click","."+this.options.targets.day,function(b){if(c.options.clickEvents.click){var d=c.buildTargetObject(b.currentTarget,!0);c.options.clickEvents.click.apply(c,[d])}c.options.adjacentDaysChangeMonth&&(a(b.currentTarget).is(".last-month")?c.backActionWithContext(c):a(b.currentTarget).is(".next-month")&&c.forwardActionWithContext(c))}),b.on("click","."+this.options.targets.empty,function(b){if(c.options.clickEvents.click){var d=c.buildTargetObject(b.currentTarget,!1);c.options.clickEvents.click.apply(c,[d])}c.options.adjacentDaysChangeMonth&&(a(b.currentTarget).is(".last-month")?c.backActionWithContext(c):a(b.currentTarget).is(".next-month")&&c.forwardActionWithContext(c))}),b.on("click","."+this.options.targets.previousButton,{context:this},this.backAction).on("click","."+this.options.targets.nextButton,{context:this},this.forwardAction).on("click","."+this.options.targets.todayButton,{context:this},this.todayAction).on("click","."+this.options.targets.nextYearButton,{context:this},this.nextYearAction).on("click","."+this.options.targets.previousYearButton,{context:this},this.previousYearAction)},e.prototype.buildTargetObject=function(b,c){var d={element:b,events:[],date:null};if(c){var e,f=b.className.indexOf("calendar-day-");e=0!==f?b.className.substring(f+13,f+23):b.id.replace("calendar-day-",""),d.date=moment(e),this.options.events&&(d.events=a.makeArray(a(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM-DD")==e})))}return d},e.prototype.forwardAction=function(a){var b=a.data.context;b.forwardActionWithContext(b)},e.prototype.backAction=function(a){var b=a.data.context;b.backActionWithContext(b)},e.prototype.backActionWithContext=function(a){var b=!a.month.isSame(moment(),"year");a.month.subtract("months",1),a.options.clickEvents.previousMonth&&a.options.clickEvents.previousMonth.apply(a,[moment(a.month)]),a.options.clickEvents.onMonthChange&&a.options.clickEvents.onMonthChange.apply(a,[moment(a.month)]),b&&a.options.clickEvents.onYearChange&&a.options.clickEvents.onYearChange.apply(a,[moment(a.month)]),a.render()},e.prototype.forwardActionWithContext=function(a){var b=!a.month.isSame(moment(),"year");a.month.add("months",1),a.options.clickEvents.nextMonth&&a.options.clickEvents.nextMonth.apply(a,[a.month]),a.options.clickEvents.onMonthChange&&a.options.clickEvents.onMonthChange.apply(a,[a.month]),b&&a.options.clickEvents.onYearChange&&a.options.clickEvents.onYearChange.apply(a,[moment(a.month)]),a.render()},e.prototype.todayAction=function(a){var b=a.data.context,c=!b.month.isSame(moment(),"month"),d=!b.month.isSame(moment(),"year");b.options.clickEvents.today&&b.options.clickEvents.today.apply(b,[moment(b.month)]),c&&(b.month=moment(),b.options.clickEvents.onMonthChange&&b.options.clickEvents.onMonthChange.apply(b,[moment(b.month)]),d&&b.options.clickEvents.onYearChange&&b.options.clickEvents.onYearChange.apply(b,[moment(b.month)]),b.render())},e.prototype.nextYearAction=function(a){var b=a.data.context;b.month.add("years",1),b.options.clickEvents.nextYear&&b.options.clickEvents.nextYear.apply(b,[moment(b.month)]),b.options.clickEvents.onMonthChange&&b.options.clickEvents.onMonthChange.apply(b,[moment(b.month)]),b.options.clickEvents.onYearChange&&b.options.clickEvents.onYearChange.apply(b,[moment(b.month)]),b.render()},e.prototype.previousYearAction=function(a){var b=a.data.context;b.month.subtract("years",1),b.options.clickEvents.previousYear&&b.options.clickEvents.previousYear.apply(b,[moment(b.month)]),b.options.clickEvents.onMonthChange&&b.options.clickEvents.onMonthChange.apply(b,[moment(b.month)]),b.options.clickEvents.onYearChange&&b.options.clickEvents.onYearChange.apply(b,[moment(b.month)]),b.render()},e.prototype.forward=function(){return this.month.add("months",1),this.render(),this},e.prototype.back=function(){return this.month.subtract("months",1),this.render(),this},e.prototype.next=function(){return this.forward(),this},e.prototype.previous=function(){return this.back(),this},e.prototype.setMonth=function(a){return this.month.month(a),this.render(),this},e.prototype.setYear=function(a){return this.month.year(a),this.render(),this},e.prototype.nextYear=function(){return this.month.add("year",1),this.render(),this},e.prototype.previousYear=function(){return this.month.subtract("year",1),this.render(),this},e.prototype.setYear=function(a){return this.month.year(a),this.render(),this},e.prototype.setEvents=function(a){return this.options.events=this.addMomentObjectToEvents(a),this.render(),this},e.prototype.addEvents=function(b){return this.options.events=a.merge(this.options.events,this.addMomentObjectToEvents(b)),this.render(),this},e.prototype.addMomentObjectToEvents=function(a){var b=this,c=0,d=a.length;for(c;d>c;c++)a[c]._clndrDateObject=moment(a[c][b.options.dateParameter]);return a},e.prototype.calendarDay=function(b){var c={day:"",classes:this.options.targets.empty,events:[],id:"",date:null};return a.extend({},c,b)},a.fn.clndr=function(b){if(!a.data(this,"plugin_clndr")){var c=new e(this,b);return a.data(this,"plugin_clndr",c),c}}}(jQuery,window,document);